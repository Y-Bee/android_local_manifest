From c695872afaa6ce3bf669c6b5e01bda031fb719d6 Mon Sep 17 00:00:00 2001
From: Konsta <konsta09@gmail.com>
Date: Fri, 2 Jan 2015 16:44:48 +0200
Subject: [PATCH 2/2] custom navigation bar height (2/2)

Change-Id: Ie5156ff97a71aba29245ab2df3a7bd4988e4a223
---
 res/values/cm_arrays.xml                     |   21 +++++++++++++++++++++
 res/values/cm_strings.xml                    |   10 ++++++++++
 res/xml/button_settings.xml                  |    9 +++++++++
 src/com/android/settings/ButtonSettings.java |   16 ++++++++++++++++
 4 files changed, 56 insertions(+)

diff --git a/res/values/cm_arrays.xml b/res/values/cm_arrays.xml
index 8571c7b..d251faf 100644
--- a/res/values/cm_arrays.xml
+++ b/res/values/cm_arrays.xml
@@ -15,6 +15,27 @@
      limitations under the License.
 -->
 <resources>
+    <!--- Navigation bar height -->
+    <string-array name="nav_buttons_height_entries" translatable="false">
+        <item>@string/navigation_bar_height_48</item>
+        <item>@string/navigation_bar_height_44</item>
+        <item>@string/navigation_bar_height_40</item>
+        <item>@string/navigation_bar_height_36</item>
+        <item>@string/navigation_bar_height_32</item>
+        <item>@string/navigation_bar_height_28</item>
+        <item>@string/navigation_bar_height_24</item>
+    </string-array>
+
+    <string-array name="nav_buttons_height_values" translatable="false">
+        <item>48</item>
+        <item>44</item>
+        <item>40</item>
+        <item>36</item>
+        <item>32</item>
+        <item>28</item>
+        <item>24</item>
+    </string-array>
+
     <!-- Arrays for root access capability -->
     <string-array name="root_access_entries">
         <item>@string/root_access_none</item>
diff --git a/res/values/cm_strings.xml b/res/values/cm_strings.xml
index 8411a9d..20f4fc3 100644
--- a/res/values/cm_strings.xml
+++ b/res/values/cm_strings.xml
@@ -396,6 +396,16 @@
     <string name="navigation_bar_left_title">Left-handed mode</string>
     <string name="navigation_bar_left_summary">Place the navigation bar on the left side of the screen in landscape mode</string>
 
+    <!-- Navigation bar height -->
+    <string name="navigation_bar_height">Button height</string>
+    <string name="navigation_bar_height_48">48dp (default)</string>
+    <string name="navigation_bar_height_44">44dp</string>
+    <string name="navigation_bar_height_40">40dp</string>
+    <string name="navigation_bar_height_36">36dp</string>
+    <string name="navigation_bar_height_32">32dp</string>
+    <string name="navigation_bar_height_28">28dp</string>
+    <string name="navigation_bar_height_24">24dp</string>
+
     <string name="header_category_personalization">Personalization</string>
 
     <!-- Status bar -->
diff --git a/res/xml/button_settings.xml b/res/xml/button_settings.xml
index 1584e98..47a07fe 100644
--- a/res/xml/button_settings.xml
+++ b/res/xml/button_settings.xml
@@ -33,6 +33,15 @@
         android:key="navigation_bar"
         android:title="@string/navigation_bar_category" >
 
+        <ListPreference
+            android:key="nav_buttons_height"
+            android:dialogTitle="@string/navigation_bar_height"
+            android:title="@string/navigation_bar_height"
+            android:entries="@array/nav_buttons_height_entries"
+            android:entryValues="@array/nav_buttons_height_values"
+            android:defaultValue="48"
+            android:persistent="false" />
+
         <com.android.settings.cyanogenmod.SystemSettingSwitchPreference
             android:key="navigation_bar_left"
             android:title="@string/navigation_bar_left_title"
diff --git a/src/com/android/settings/ButtonSettings.java b/src/com/android/settings/ButtonSettings.java
index 76cd64c..b2bc966 100644
--- a/src/com/android/settings/ButtonSettings.java
+++ b/src/com/android/settings/ButtonSettings.java
@@ -62,6 +62,7 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
     private static final String KEY_SWAP_VOLUME_BUTTONS = "swap_volume_buttons";
     private static final String DISABLE_NAV_KEYS = "disable_nav_keys";
     private static final String KEY_NAVIGATION_BAR_LEFT = "navigation_bar_left";
+    private static final String KEY_NAVIGATION_HEIGHT = "nav_buttons_height";
     private static final String KEY_POWER_END_CALL = "power_end_call";
     private static final String KEY_HOME_ANSWER_CALL = "home_answer_call";
 
@@ -108,6 +109,7 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
     private ListPreference mAppSwitchPressAction;
     private ListPreference mAppSwitchLongPressAction;
     private ListPreference mVolumeKeyCursorControl;
+    private ListPreference mNavButtonsHeight;
     private SwitchPreference mSwapVolumeButtons;
     private SwitchPreference mDisableNavigationKeys;
     private SwitchPreference mNavigationBarLeftPref;
@@ -175,6 +177,9 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
         // Force Navigation bar related options
         mDisableNavigationKeys = (SwitchPreference) findPreference(DISABLE_NAV_KEYS);
 
+        // Navigation bar height
+        mNavButtonsHeight = (ListPreference) findPreference(KEY_NAVIGATION_HEIGHT);
+
         mNavigationPreferencesCat = (PreferenceCategory) findPreference(CATEGORY_NAVBAR);
 
         // Navigation bar left
@@ -347,6 +352,13 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
                 mNavigationPreferencesCat.removePreference(mNavigationBarLeftPref);
             }
 
+            if (hasNavBar) {
+                // Navigation bar height
+                int statusNavButtonsHeight = Settings.System.getInt(resolver,
+                        Settings.System.NAV_BUTTONS_HEIGHT, 48);
+                mNavButtonsHeight = initActionList(KEY_NAVIGATION_HEIGHT, statusNavButtonsHeight);
+            }
+
             if ((!hasNavBar && (needsNavigationBar || !isKeyDisablerSupported())) ||
                 (mNavigationPreferencesCat.getPreferenceCount() == 0)
             ) {
@@ -443,6 +455,10 @@ public class ButtonSettings extends SettingsPreferenceFragment implements
             handleActionListChange(mVolumeKeyCursorControl, newValue,
                     Settings.System.VOLUME_KEY_CURSOR_CONTROL);
             return true;
+        } else if (preference == mNavButtonsHeight) {
+            handleActionListChange(mNavButtonsHeight, newValue,
+                    Settings.System.NAV_BUTTONS_HEIGHT);
+            return true;
         }
         return false;
     }
-- 
1.7.9.5

